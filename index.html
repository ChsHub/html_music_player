<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style type="text/css">
        .track {
            background-color: white;
        }

        #marked {
            background-color: lightskyblue;
        }

        #player {
            height: 10px;
            width: 600px;
            padding: 40px;
        }

        #messages {
            background-color: firebrick;
        }

        #myRange {
            width: 600px;
        }

        div, input, button {
            padding: 10px;
        }
    </style>
    <script type="text/javascript">
        // Todo debug stack
        // Todo use OOP
        // Todo fit to screen size
        var input_tracks = 0;
        var loop_tracklist = false;
        var stack = [];
        var stack_pointer = 0;

        function get_current() {
            return stack[stack_pointer];
        }
        function push_top() {
            var new_ele = stack[stack_pointer - 1] + 1;
            if (new_ele == input_tracks.files.length) {
                new_ele = 0;
            }
            stack.push(new_ele);
        }

        function push_bottom() {

            var new_ele = stack[0] - 1;
            if (new_ele == -1) {
                new_ele = input_tracks.files.length - 1;
            }

            var bottom = [new_ele];

            stack = bottom.concat(stack);
            set_message(stack);
            stack_pointer = 0;
        }

        function set_next(id) {
            stack_pointer++;
            stack.push(id);
            return id;
        }

        function get_next() {
            stack_pointer++;

            if (stack.length == stack_pointer) {
                push_top();
            }
            return stack[stack_pointer];
        }

        function get_prev() {
            stack_pointer--;

            if (-1 == stack_pointer) {
                push_bottom();
            }
            return stack[0];
        }


        function set_message(text) {
            var messages = document.getElementById('messages');
            var textnode = document.createTextNode(text + "\n");
            var node = document.createElement("LI");                 // Create a <li> node
            node.appendChild(textnode);
            messages.appendChild(node);
        }

        function get_files() {
            input_tracks = document.getElementById('filesToUpload');
            var fileList = document.getElementById('fileList');

            //empty list for now...
            while (fileList.hasChildNodes()) {
                fileList.removeChild(fileList.lastChild);
            }

            //for every file...
            for (var x = 0; x < input_tracks.files.length; x++) {
                //add to list
                //text1 = 'File ' + (x + 1) + ':  ' + input_tracks.files[x].name;
                var text1 = input_tracks.files[x].name;
                var node = document.createElement("div");                 // Create a <li> node
                node.className = "track";
                node.setAttribute("onClick", "play_id_track(" + x + ");");
                var textnode = document.createTextNode(text1);         // Create a text node

                node.appendChild(textnode);                              // Append the text to <li>
                fileList.appendChild(node);     // Append <li> to <ul> with id="myList"
            }
            stack = [input_tracks.files.length - 1];
            play_next_track();
        }

        // function open_file() {
        //     var loc = window.location.pathname;
        //     var dir = loc.substring(0, loc.lastIndexOf('/'));
        //     document.getElementById('boldStuff').innerHTML = loc;
        // }

        function play_file(track) {

            mark_current_file_view(track);
            set_message(track);
            var file = URL.createObjectURL(input_tracks.files[track]);

            set_message(file);
            var player = document.getElementById('player');
            //if(player.canPlayType(file))

            player.pause();
            player.src = file;
            player.play();
            document.getElementById("player").volume = get_init_volume() / 100;
        }

        function stop() {
            var player = document.getElementById('player');
            player.pause();

            var button = document.getElementById('start_stop_button');
            button.setAttribute("onClick", "play();");
            button.innerHTML = "Play Video";
        }

        function play() {
            var player = document.getElementById('player');
            player.play();


            var button = document.getElementById('start_stop_button');
            button.setAttribute("onClick", "stop();");
            button.innerHTML = "Stop Video";

        }

        function get_init_volume() {
            return 10;
        }

        function mark_current_file_view(track) {
            var track_view = document.getElementsByClassName("track")[track];

            track_view.id = "marked";

        }

        function unmark_current_file_view() {
            set_message("TRACK");
            var marked = document.getElementById("marked");
            set_message(marked);
            if (marked != null) {
                marked.id = "unmarked";
            }

            set_message("TRAC1K");
        }


        function on_ended() {
            play_next_track();
        }

        function next() {
            play_next_track();
        }

        function prev() {
            play_prev_track();
        }


        function play_next_track() {
            unmark_current_file_view();

            play_file(get_next())
        }

        function play_prev_track() {
            unmark_current_file_view();
            play_file(get_prev())
        }

        function play_id_track(id) {
            unmark_current_file_view();
            play_file(set_next(id))
        }

        var Model = function(){};
        change_volume = function(volume)
        {

            document.getElementById('player').volume = volume;

        };
        var myModel = Model();
        var View = function(){};
        function onchange_volume()
        {
            var volume = document.getElementById('myRange').value / 100;
            set_message(volume);
            change_volume(volume);

            document.getElementById('volume_label').innerHTML = volume;
        }
        var  myView = View();



        var Stack = function(){};
        var log = function(){};
    </script>
</head>

<body>
<div>
    <video
            controls=""
            id="player" onended="on_ended()">No support
    </video>
</div>
<div>
    <input type="file" name="filesToUpload" id="filesToUpload" multiple="" onchange="get_files();"/>
</div>

<div>
    <button onclick="prev()" type="button">Prev Video</button>
    <button id="start_stop_button" onclick="stop()" type="button">Stop Video</button>
    <button onclick="next()" type="button">Next Video</button>
    <br>
    <label for="myRange">Volume</label>
    <input type="range" name="firstname" id="myRange" value="1" onchange="onchange_volume()">
    <label id="volume_label"></label>
    <br>
</div>

<div id="fileList">
    <div class="track" id="marked">No Files Selected1</div>
</div>

<ol id="messages"></ol>
</body>
</html>